#version2
name: Build APK (Calc Edition)

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-20.04

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up dependencies
        run: |
          sudo apt-get update -y
          sudo apt-get install -y python3 python3-pip openjdk-17-jdk zip unzip git
          pip install --upgrade pip setuptools wheel
          pip install buildozer cython virtualenv

      - name: Prepare buildozer project
        run: |
          if [ ! -f buildozer.spec ]; then
            buildozer init
          fi
          echo "requirements = python3,kivy" >> buildozer.spec
          echo "package.domain = org.example" >> buildozer.spec
          echo "package.name = calculator" >> buildozer.spec
          echo "title = Калькулятор" >> buildozer.spec

      - name: Build APK
        run: |
          buildozer android debug
        env:
          BUILDOZER_WARN_ON_ROOT: 0

      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: calculator-apk
          path: bin/*.apk
